---
description: React Hook Form with Zod validation patterns for Next.js
globs: src/components/**/*Form*.tsx, app/**/*Form*.tsx
alwaysApply: false
---
# React Hook Form + Zod Validation Rules (Next.js)

## Schema Definition
- Define Zod schemas colocated or in `src/schemas/`.
- Use `z.infer<typeof schema>`.
- Schemas can be shared between Client (form) and Server (Action validation).

## Form Setup (Next.js)
- **Client Components:** Forms using `useForm` must be `'use client'`.
- Use `useForm` with `zodResolver`.
- Define default values.

## Server Actions Integration
- Prefer **Server Actions** for submission over API routes.
- Validate data again on the server using the same Zod schema.
- Use `useFormState` (or `useActionState` in newer React) for server response handling if not using `useForm`'s `handleSubmit` directly with an action.
- **Pattern:** `handleSubmit(async (data) => { await serverAction(data) })`.

## Error Handling
- Display field errors from `formState.errors`.
- Handle server-side validation errors returned from Server Actions.
- Show loading states with `isSubmitting`.

## Best Practices
- **Validation:** Validate on Client (UX) AND Server (Security).
- **Types:** Share TypeScript types inferred from Zod.
- **Reset:** Reset form after successful Server Action if needed.

## Examples
<example>
// app/actions.ts (Server Action)
'use server';
import { projectSchema } from '@/schemas/project';

export async function createProject(data: unknown) {
  const result = projectSchema.safeParse(data);
  if (!result.success) return { error: result.error.flatten() };
  // Save to DB...
  return { success: true };
}

// app/components/ProjectForm.tsx
'use client';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { projectSchema, type ProjectFormData } from '@/schemas/project';
import { createProject } from '@/app/actions';

export default function ProjectForm() {
  const { register, handleSubmit, formState: { errors } } = useForm<ProjectFormData>({
    resolver: zodResolver(projectSchema),
  });

  const onSubmit = async (data: ProjectFormData) => {
    await createProject(data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <input {...register("name")} />
      {errors.name && <span>{errors.name.message}</span>}
      <button type="submit">Submit</button>
    </form>
  );
}
</example>
